<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Masajes con Nury — Reservas</title>
  <meta name="description" content="Masajes con Nury: reserva online tipo calendario. Servicios, galería y contacto." />

  <style>
    :root{
      --bg:#ffffff;
      --ink:#0b1024;
      --muted:#44506a;

      --hero-bg:#BFD3EA;
      --hero-card:#4A469C;
      --hero-card-2:#5856B0;
      --hero-yellow:#FFD400;
      --hero-white:#FFFFFF;

      --navy:#0b1024;
      --violet:#6D28D9;

      --stroke: rgba(11,16,36,.10);
      --shadow: 0 18px 55px rgba(11,16,36,.16);
      --radius: 22px;
      --radius2: 28px;

      --max: 1120px;
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: var(--bg);
      color: var(--ink);
      overflow-x:hidden;
    }
    a{color:inherit;text-decoration:none}
    .container{max-width:var(--max); margin:0 auto; padding:0 18px;}
    main{padding: 26px 0 60px;}

    /* ===== HERO ===== */
    .hero-outer{
      background: var(--hero-bg);
      position:relative;
      padding: 34px 0 40px;
      overflow:hidden;
    }
    .hero-watermark{
      position:absolute;
      left:0; right:0;
      top: -8px;
      font-weight: 1000;
      letter-spacing: .06em;
      text-transform: uppercase;
      font-size: clamp(44px, 6.8vw, 92px);
      color: rgba(11,16,36,.10);
      line-height: .9;
      text-align:center;
      pointer-events:none;
      user-select:none;
      white-space:nowrap;
    }

    .hero-card{
      width: min(980px, calc(100% - 36px));
      margin: 0 auto;
      border-radius: var(--radius2);
      background: linear-gradient(180deg, var(--hero-card), var(--hero-card-2));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      border: 1px solid rgba(255,255,255,.20);
    }

    .hero-topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 14px 16px;
      gap: 12px;
      position: relative; /* for dropdown anchor */
    }

    .hero-pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.92);
      color: #1b223a;
      font-weight: 900;
      font-size: 13px;
      border: 1px solid rgba(11,16,36,.08);
      cursor:pointer;
      user-select:none;
      position: relative; /* dropdown attaches here */
    }
    .hero-pill:focus{
      outline:none;
      box-shadow: 0 0 0 4px rgba(109,40,217,.14);
    }
    .hero-pill .bars{
      width:16px;height:12px; position:relative; display:inline-block;
    }
    .hero-pill .bars:before,
    .hero-pill .bars:after,
    .hero-pill .bars i{
      content:"";
      position:absolute; left:0; right:0;
      height:2px; border-radius:2px;
      background:#1b223a;
      opacity:.9;
    }
    .hero-pill .bars:before{top:0}
    .hero-pill .bars i{top:5px}
    .hero-pill .bars:after{bottom:0}

    .hero-spacer{flex:1}

    .hero-cta{
      padding: 10px 16px;
      border-radius: 999px;
      background: var(--hero-yellow);
      color: #1b223a;
      font-weight: 1000;
      border: 0;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 10px 30px rgba(255,212,0,.18);
      white-space:nowrap;
    }

    /* ✅ DROPDOWN MENU UNDER "MENU" */
    .menu-dropdown{
      position:absolute;
      top: calc(100% + 10px);
      left: 0;
      width: 280px;
      border-radius: 18px;
      background: #fff;
      border: 1px solid var(--stroke);
      box-shadow: 0 18px 55px rgba(11,16,36,.18);
      padding: 10px;
      display: none;
      z-index: 50;
      transform-origin: top left;
    }
    .menu-dropdown.show{display:block}
    .menu-dropdown a{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 12px 12px;
      border-radius: 14px;
      font-weight: 900;
      color: var(--muted);
    }
    .menu-dropdown a:hover{
      background: rgba(11,16,36,.04);
      color: var(--ink);
    }
    .menu-dropdown .divider{
      height:1px;
      background: rgba(11,16,36,.08);
      margin: 6px 6px;
      border-radius:999px;
    }
    .menu-dropdown .mini{
      font-size: 12px;
      font-weight: 900;
      color: rgba(68,80,106,.9);
      padding: 10px 12px 6px;
    }
    .menu-dropdown .actions{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      padding: 8px 6px 6px;
    }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background:#fff;
      color: var(--ink);
      font-weight: 1000;
      cursor:pointer;
      font-size: 13px;
      white-space: nowrap;
    }
    .btn.primary{
      border:0;
      background: linear-gradient(90deg, var(--violet), #8B5CF6);
      color:#fff;
      box-shadow: 0 12px 30px rgba(109,40,217,.18);
    }

    .hero-content{
      padding: 26px 18px 0;
      text-align:center;
      color: var(--hero-white);
    }

    .hero-title{
      margin:0;
      font-weight: 1000;
      letter-spacing: .02em;
      text-transform: uppercase;
      font-size: clamp(34px, 4.6vw, 60px);
      line-height: 1.05;
    }

    .hero-script{
      margin-top: 6px;
      font-weight: 1000;
      font-size: clamp(34px, 5.0vw, 64px);
      line-height: 1;
      color: var(--hero-yellow);
      font-family: "Comic Sans MS", "Brush Script MT", "Segoe Script", cursive;
      letter-spacing: .02em;
      transform: rotate(-2deg);
      display:inline-block;
    }

    .hero-scroll{
      margin: 18px 0 14px;
      color: rgba(255,255,255,.78);
      font-weight: 800;
      font-size: 13px;
    }

    .hero-bottom{
      position:relative;
      height: 210px;
      margin-top: 12px;
      background: rgba(255,255,255,.06);
      border-top: 1px solid rgba(255,255,255,.18);
      display:flex;
      align-items:flex-end;
      justify-content:center;
    }

    .crowd{
      width: 100%;
      max-width: 980px;
      height: 210px;
      display:block;
    }

    /* ===== Sections ===== */
    .section{padding: 52px 0;}
    .section h2{
      margin:0 0 8px;
      font-size: clamp(22px, 3vw, 30px);
      letter-spacing:-.02em;
    }
    .section p.lead{
      margin:0 0 18px;
      color: var(--muted);
      max-width: 70ch;
      line-height:1.6;
      font-weight: 700;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }
    @media (max-width: 980px){ .grid{grid-template-columns: 1fr} }

    .card{
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      background: #fff;
      box-shadow: 0 14px 40px rgba(11,16,36,.06);
      padding: 16px;
    }
    .card h3{margin:0 0 6px; font-size:16px}
    .card p{margin:0; color: var(--muted); line-height:1.55; font-weight:700; font-size:13px}
    .tag{
      display:inline-flex;
      margin-top: 12px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      background: rgba(109,40,217,.06);
      color: var(--navy);
      font-weight: 900;
      font-size: 12px;
    }

    /* ===== Calendar booking ===== */
    .booking-wrap{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 980px){ .booking-wrap{grid-template-columns:1fr} }

    .calendar{
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background:#fff;
      box-shadow: 0 14px 40px rgba(11,16,36,.06);
      padding: 14px;
    }
    .cal-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }
    .cal-title{font-weight: 1000; letter-spacing:-.01em;}
    .cal-nav{display:flex; gap:8px;}
    .cal-btn{
      width: 40px;height:40px;
      border-radius: 12px;
      border:1px solid var(--stroke);
      background:#fff;
      cursor:pointer;
      font-weight: 1000;
    }
    .cal-grid{display:grid; grid-template-columns: repeat(7, 1fr); gap: 8px;}
    .dow{
      font-size: 11px; color: var(--muted);
      font-weight: 900; text-align:center; padding: 8px 0;
    }
    .day{
      position:relative;
      aspect-ratio: 1 / 1;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background:#fff;
      cursor:pointer;
      display:flex;
      align-items:flex-start;
      justify-content:flex-start;
      padding: 8px;
      font-weight: 900;
      color: var(--ink);
      transition:.15s transform, .15s border, .15s background;
      user-select:none;
    }
    .day:hover{transform: translateY(-1px); border-color: rgba(109,40,217,.22); background: rgba(109,40,217,.04);}
    .day.muted{opacity:.35; cursor:not-allowed; transform:none !important;}
    .day.selected{border-color: rgba(109,40,217,.35); background: rgba(109,40,217,.10);}
    .day .dot{
      position:absolute; right:8px; bottom:8px;
      width: 8px;height:8px;border-radius:999px;
      background: linear-gradient(90deg, var(--violet), #8B5CF6);
      display:none;
    }
    .day.has-booking .dot{display:block}

    .booking-panel{
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      background:#fff;
      box-shadow: 0 14px 40px rgba(11,16,36,.06);
      padding: 14px;
    }
    .field{margin: 10px 0}
    .field label{
      display:block;
      font-weight: 900;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 8px;
    }
    input, select, textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background:#fff;
      font-weight: 900;
      outline:none;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(109,40,217,.30);
      box-shadow: 0 0 0 4px rgba(109,40,217,.08);
    }
    textarea{min-height: 92px; resize:vertical; font-weight:800}
    .hint{color: var(--muted); font-weight: 800; font-size: 12px; line-height:1.5;}

    .slots{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 520px){ .slots{grid-template-columns: repeat(2, 1fr);} }
    .slot{
      padding: 12px 10px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background:#fff;
      cursor:pointer;
      text-align:center;
      font-weight:1000;
      color: var(--muted);
      transition:.15s transform, .15s border, .15s background, .15s color;
      user-select:none;
    }
    .slot:hover{transform: translateY(-1px); border-color: rgba(109,40,217,.22); color: var(--ink);}
    .slot.selected{border-color: rgba(109,40,217,.35); background: rgba(109,40,217,.10); color: var(--ink);}
    .slot[disabled]{opacity:.35; cursor:not-allowed; transform:none !important;}

    .alert{
      margin-top: 10px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(16,185,129,.30);
      background: rgba(16,185,129,.08);
      color: #065f46;
      font-weight: 900;
      display:none;
    }
    .alert.show{display:block}
    .error{
      margin-top: 10px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(239,68,68,.25);
      background: rgba(239,68,68,.06);
      color: #7f1d1d;
      font-weight: 900;
      display:none;
    }
    .error.show{display:block}

    /* Gallery placeholders */
    .gallery{
      display:grid;
      grid-template-columns: 1.2fr .8fr .8fr;
      gap: 14px;
    }
    @media (max-width: 980px){ .gallery{grid-template-columns:1fr} }
    .ph{
      border:1px dashed rgba(11,16,36,.22);
      border-radius: var(--radius);
      min-height: 220px;
      background: #fff;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 16px;
      color: var(--muted);
      font-weight: 1000;
      box-shadow: 0 14px 40px rgba(11,16,36,.05);
    }
    .ph.small{min-height: 160px;}

    footer{
      margin-top: 34px;
      padding-top: 18px;
      border-top: 1px solid var(--stroke);
      color: var(--muted);
      font-weight: 800;
      font-size: 12px;
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    /* Small screens: dropdown fits */
    @media (max-width: 380px){
      .menu-dropdown{width: 240px;}
    }
  </style>
</head>

<body>
  <!-- HERO -->
  <header class="hero-outer" id="top">
    <div class="hero-watermark">WE CREATE WEBSITES THAT FILL SEATS</div>

    <div class="hero-card" role="banner" aria-label="Masajes con Nury">
      <div class="hero-topbar">
        <!-- MENU -->
        <button class="hero-pill" type="button" id="heroMenuBtn" aria-expanded="false" aria-controls="heroDropdown">
          <span class="bars"><i></i></span>
          MENU

          <!-- ✅ dropdown opens under MENU -->
          <div class="menu-dropdown" id="heroDropdown" role="menu">
            <div class="mini">Navegación</div>
            <a href="#servicios" data-scroll="servicios" role="menuitem">Servicios <span>→</span></a>
            <a href="#reservas" data-scroll="reservas" role="menuitem">Reservas <span>→</span></a>
            <a href="#galeria" data-scroll="galeria" role="menuitem">Galería <span>→</span></a>
            <a href="#contacto" data-scroll="contacto" role="menuitem">Contacto <span>→</span></a>
            <div class="divider"></div>
            <div class="actions">
              <button class="btn" type="button" id="openWhatsAppBtn">WhatsApp</button>
              <button class="btn primary" type="button" data-scroll-btn="reservas">Reservar</button>
            </div>
          </div>
        </button>

        <div class="hero-spacer" aria-hidden="true"></div>

        <button class="hero-cta" type="button" id="heroTalkBtn">LET’S TALK</button>
      </div>

      <div class="hero-content">
        <h1 class="hero-title">MASAJES PROFESIONALES<br/>QUE TE CAMBIAN EL DÍA</h1>
        <div class="hero-script">con Nury</div>
        <div class="hero-scroll">scroll to see more</div>
      </div>

      <div class="hero-bottom" aria-hidden="true">
        <svg class="crowd" viewBox="0 0 980 210" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="fog" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0" stop-color="rgba(255,255,255,.08)"/>
              <stop offset="1" stop-color="rgba(255,255,255,.00)"/>
            </linearGradient>
            <filter id="blur" x="-20%" y="-20%" width="140%" height="140%">
              <feGaussianBlur stdDeviation="2.2"/>
            </filter>
          </defs>

          <rect x="0" y="0" width="980" height="210" fill="url(#fog)"/>

          <g opacity="0.95">
            <g filter="url(#blur)" opacity="0.55">
              <circle cx="120" cy="150" r="26" fill="#0b1024"/>
              <rect x="88" y="170" width="64" height="70" rx="24" fill="#0b1024"/>
              <circle cx="220" cy="152" r="24" fill="#0b1024"/>
              <rect x="190" y="172" width="60" height="72" rx="24" fill="#0b1024"/>
              <circle cx="320" cy="148" r="28" fill="#0b1024"/>
              <rect x="286" y="170" width="68" height="74" rx="24" fill="#0b1024"/>
              <circle cx="460" cy="154" r="25" fill="#0b1024"/>
              <rect x="430" y="174" width="60" height="72" rx="24" fill="#0b1024"/>
              <circle cx="600" cy="150" r="27" fill="#0b1024"/>
              <rect x="568" y="172" width="64" height="74" rx="24" fill="#0b1024"/>
              <circle cx="740" cy="153" r="24" fill="#0b1024"/>
              <rect x="712" y="173" width="56" height="72" rx="24" fill="#0b1024"/>
              <circle cx="860" cy="149" r="28" fill="#0b1024"/>
              <rect x="824" y="172" width="72" height="76" rx="24" fill="#0b1024"/>
            </g>

            <g>
              <circle cx="170" cy="150" r="30" fill="#0b1024"/>
              <rect x="132" y="178" width="76" height="86" rx="28" fill="#0b1024"/>

              <circle cx="290" cy="152" r="28" fill="#ffffff"/>
              <rect x="256" y="180" width="68" height="86" rx="28" fill="#0b1024"/>

              <circle cx="410" cy="150" r="30" fill="#0b1024"/>
              <rect x="372" y="178" width="76" height="92" rx="28" fill="#6b21a8"/>

              <circle cx="520" cy="152" r="28" fill="#0b1024"/>
              <rect x="486" y="180" width="68" height="86" rx="28" fill="#0b1024"/>

              <circle cx="640" cy="150" r="30" fill="#0b1024"/>
              <rect x="602" y="178" width="76" height="92" rx="28" fill="#ffd400"/>

              <circle cx="780" cy="152" r="28" fill="#0b1024"/>
              <rect x="748" y="180" width="64" height="86" rx="28" fill="#6b21a8"/>

              <rect x="-20" y="176" width="1020" height="90" fill="rgba(11,16,36,.25)" filter="url(#blur)" opacity="0.55"/>
            </g>
          </g>
        </svg>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- SERVICIOS -->
    <section class="section" id="servicios">
      <h2>Servicios</h2>
      <p class="lead">Elige el tipo de masaje y reserva directamente en el calendario.</p>

      <div class="grid">
        <div class="card">
          <h3>Relajante</h3>
          <p>Para estrés, descanso y tensión general. Ideal para desconectar.</p>
          <span class="tag">60 min · 50€</span>
        </div>
        <div class="card">
          <h3>Descontracturante</h3>
          <p>Enfoque muscular: espalda, cuello, piernas. Presión adaptada.</p>
          <span class="tag">75 min · 65€</span>
        </div>
        <div class="card">
          <h3>Deportivo</h3>
          <p>Preparación y recuperación para actividad física.</p>
          <span class="tag">90 min · 80€</span>
        </div>
        <div class="card">
          <h3>Piedras calientes</h3>
          <p>Calor terapéutico + aromaterapia para soltar tensión.</p>
          <span class="tag">75 min · 75€</span>
        </div>
        <div class="card">
          <h3>Facial</h3>
          <p>Masaje suave + drenaje para rostro y tensión mandibular.</p>
          <span class="tag">45 min · 45€</span>
        </div>
        <div class="card">
          <h3>Prenatal</h3>
          <p>Adaptado para embarazo (según caso) y bienestar general.</p>
          <span class="tag">60 min · 55€</span>
        </div>
      </div>
    </section>

    <!-- RESERVAS -->
    <section class="section" id="reservas">
      <h2>Reservas (Calendario)</h2>
      <p class="lead">
        Selecciona un día y un horario. Los horarios reservados quedan bloqueados.
      </p>

      <div class="booking-wrap">
        <div class="calendar" aria-label="Calendario">
          <div class="cal-top">
            <div class="cal-title" id="calTitle">Mes Año</div>
            <div class="cal-nav">
              <button class="cal-btn" id="prevMonth" type="button">‹</button>
              <button class="cal-btn" id="nextMonth" type="button">›</button>
            </div>
          </div>

          <div class="cal-grid" id="dowRow">
            <div class="dow">L</div><div class="dow">M</div><div class="dow">X</div><div class="dow">J</div><div class="dow">V</div><div class="dow">S</div><div class="dow">D</div>
          </div>
          <div class="cal-grid" id="calGrid"></div>

          <p class="hint" style="margin-top:10px;">
            • Días pasados se desactivan · • Punto violeta = hay reserva ese día
          </p>
        </div>

        <div class="booking-panel" aria-label="Formulario de reserva">
          <div style="font-weight:1000; margin-bottom:6px;">Tu cita</div>
          <div class="hint" id="selectedDayHint">Elige un día en el calendario.</div>

          <div class="field">
            <label>Servicio *</label>
            <select id="serviceSelect">
              <option value="">Selecciona…</option>
              <option value="relajante">Relajante (60 min) — 50€</option>
              <option value="descontracturante">Descontracturante (75 min) — 65€</option>
              <option value="deportivo">Deportivo (90 min) — 80€</option>
              <option value="piedras">Piedras (75 min) — 75€</option>
              <option value="facial">Facial (45 min) — 45€</option>
              <option value="prenatal">Prenatal (60 min) — 55€</option>
            </select>
          </div>

          <div class="field">
            <label>Horario *</label>
            <div class="slots" id="slots"></div>
            <div class="hint" id="slotHint">Selecciona primero día + servicio para ver horarios.</div>
          </div>

          <div class="field">
            <label>Nombre *</label>
            <input id="nameInput" placeholder="Tu nombre" />
          </div>
          <div class="field">
            <label>Email *</label>
            <input id="emailInput" type="email" placeholder="tu@email.com" />
          </div>
          <div class="field">
            <label>Teléfono *</label>
            <input id="phoneInput" placeholder="+34 600 000 000" />
          </div>
          <div class="field">
            <label>Notas (opcional)</label>
            <textarea id="notesInput" placeholder="Zonas a tratar, preferencias, lesiones, etc."></textarea>
          </div>

          <button class="btn primary" id="confirmBtn" type="button" style="width:100%; padding:12px 14px; border-radius:16px;">
            Confirmar reserva
          </button>

          <div class="error" id="errorBox"></div>
          <div class="alert" id="okBox">✅ Reserva guardada (demo).</div>
        </div>
      </div>
    </section>

    <!-- GALERÍA -->
    <section class="section" id="galeria">
      <h2>Galería</h2>
      <p class="lead">Espacios para fotos o videos reales del negocio.</p>

      <div class="gallery">
        <div class="ph">VIDEO PRINCIPAL<br><span style="font-weight:800; opacity:.7">(mp4 / YouTube embed)</span></div>
        <div class="ph small">FOTO 1</div>
        <div class="ph small">FOTO 2</div>
        <div class="ph small">FOTO 3</div>
        <div class="ph small">FOTO 4</div>
        <div class="ph small">FOTO 5</div>
      </div>

      <footer>
        <div>© 2026 Masajes con Nury</div>
        <div><a href="#reservas">Reservas</a> · <a href="#servicios">Servicios</a></div>
      </footer>
    </section>

    <!-- CONTACTO (simple) -->
    <section class="section" id="contacto">
      <h2>Contacto</h2>
      <p class="lead">Si tienes dudas, escríbenos por WhatsApp.</p>
      <div class="card">
        <h3>WhatsApp</h3>
        <p>Haz click en “LET’S TALK” o en el botón WhatsApp del menú.</p>
        <span class="tag">Respuesta rápida</span>
      </div>
    </section>
  </main>

  <script>
    // ===== Scroll helpers =====
    function scrollToId(id){
      const el = id === 'top' ? document.getElementById('top') : document.getElementById(id);
      if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
    }
    document.addEventListener('click', (e)=>{
      const a = e.target.closest('[data-scroll]');
      if(a){
        e.preventDefault();
        scrollToId(a.getAttribute('data-scroll'));
      }
      const b = e.target.closest('[data-scroll-btn]');
      if(b){
        scrollToId(b.getAttribute('data-scroll-btn'));
      }
    });

    // ===== Dropdown menu (opens under MENU) =====
    const heroMenuBtn = document.getElementById('heroMenuBtn');
    const heroDropdown = document.getElementById('heroDropdown');

    function openDropdown(){
      heroDropdown.classList.add('show');
      heroMenuBtn.setAttribute('aria-expanded','true');
    }
    function closeDropdown(){
      heroDropdown.classList.remove('show');
      heroMenuBtn.setAttribute('aria-expanded','false');
    }
    function toggleDropdown(){
      const isOpen = heroDropdown.classList.contains('show');
      if(isOpen) closeDropdown(); else openDropdown();
    }

    heroMenuBtn.addEventListener('click', (e)=>{
      // Important: allow click on links inside dropdown to work (they bubble)
      const clickedInsideDropdown = e.target.closest('#heroDropdown');
      if(clickedInsideDropdown) return;
      toggleDropdown();
    });

    // Close when clicking outside
    document.addEventListener('click', (e)=>{
      const inside = e.target.closest('#heroMenuBtn');
      if(!inside) closeDropdown();
    });

    // Close on Escape
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape') closeDropdown();
    });

    // Close after clicking any dropdown link/button
    heroDropdown.addEventListener('click', (e)=>{
      const isLink = e.target.closest('a,[data-scroll-btn],button');
      if(isLink){
        closeDropdown();
      }
    });

    // WhatsApp buttons
    document.getElementById('heroTalkBtn')?.addEventListener('click', ()=>{
      window.open('https://wa.me/34600000000', '_blank');
    });
    document.getElementById('openWhatsAppBtn')?.addEventListener('click', ()=>{
      window.open('https://wa.me/34600000000', '_blank');
    });

    // ===== Calendar Booking (localStorage demo) =====
    const calTitle = document.getElementById('calTitle');
    const calGrid  = document.getElementById('calGrid');
    const prevMonthBtn = document.getElementById('prevMonth');
    const nextMonthBtn = document.getElementById('nextMonth');

    const serviceSelect = document.getElementById('serviceSelect');
    const slotsWrap = document.getElementById('slots');
    const slotHint = document.getElementById('slotHint');

    const nameInput = document.getElementById('nameInput');
    const emailInput = document.getElementById('emailInput');
    const phoneInput = document.getElementById('phoneInput');
    const notesInput = document.getElementById('notesInput');

    const confirmBtn = document.getElementById('confirmBtn');
    const errorBox = document.getElementById('errorBox');
    const okBox = document.getElementById('okBox');
    const selectedDayHint = document.getElementById('selectedDayHint');

    const services = {
      relajante: { name:"Relajante", duration:60, price:"50€" },
      descontracturante: { name:"Descontracturante", duration:75, price:"65€" },
      deportivo: { name:"Deportivo", duration:90, price:"80€" },
      piedras: { name:"Piedras", duration:75, price:"75€" },
      facial: { name:"Facial", duration:45, price:"45€" },
      prenatal: { name:"Prenatal", duration:60, price:"55€" },
    };

    const OPEN = 9;
    const CLOSE = 19;
    const STEP = 30;

    const pad = (n)=> String(n).padStart(2,'0');
    const fmtDate = (d)=> `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
    const fmtTime = (m)=>{
      const h = Math.floor(m/60);
      const mm = m%60;
      return `${pad(h)}:${pad(mm)}`;
    };

    function getBookings(){
      try{ return JSON.parse(localStorage.getItem('nury_bookings') || '[]'); }
      catch{ return []; }
    }
    function saveBooking(b){
      const all = getBookings();
      all.push(b);
      localStorage.setItem('nury_bookings', JSON.stringify(all));
    }
    function hasBookingOnDate(dateStr){
      return getBookings().some(b=> b.date === dateStr);
    }
    function isSlotBooked(dateStr, timeStr){
      return getBookings().some(b=> b.date === dateStr && b.time === timeStr);
    }

    let view = new Date();
    view.setDate(1);

    let selectedDateStr = "";
    let selectedTimeStr = "";

    function monthName(m){
      return ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][m];
    }

    function renderCalendar(){
      calGrid.innerHTML = "";
      const y = view.getFullYear();
      const m = view.getMonth();
      calTitle.textContent = `${monthName(m)} ${y}`;

      const first = new Date(y, m, 1);
      const last  = new Date(y, m+1, 0);

      const jsDow = first.getDay();
      const mondayIndex = (jsDow + 6) % 7;

      for(let i=0;i<mondayIndex;i++){
        const empty = document.createElement('div');
        empty.className = "day muted";
        empty.style.visibility = "hidden";
        calGrid.appendChild(empty);
      }

      const today = new Date();
      const todayStr = fmtDate(today);

      for(let d=1; d<=last.getDate(); d++){
        const dateObj = new Date(y, m, d);
        const dateStr = fmtDate(dateObj);

        const btn = document.createElement('div');
        btn.className = "day";
        btn.textContent = d;

        if(hasBookingOnDate(dateStr)) btn.classList.add('has-booking');

        const dot = document.createElement('span');
        dot.className = "dot";
        btn.appendChild(dot);

        if(dateStr < todayStr){
          btn.classList.add('muted');
        } else {
          btn.addEventListener('click', ()=>{
            selectedDateStr = dateStr;
            selectedTimeStr = "";
            document.querySelectorAll('.day.selected').forEach(x=>x.classList.remove('selected'));
            btn.classList.add('selected');
            selectedDayHint.textContent = `Día seleccionado: ${dateStr}`;
            buildSlots();
            okBox.classList.remove('show');
            errorBox.classList.remove('show');
          });
        }

        if(dateStr === selectedDateStr){
          btn.classList.add('selected');
        }

        calGrid.appendChild(btn);
      }
    }

    function buildSlots(){
      slotsWrap.innerHTML = "";
      selectedTimeStr = "";
      slotHint.textContent = "Selecciona un horario.";

      if(!selectedDateStr || !serviceSelect.value){
        slotHint.textContent = "Selecciona primero día + servicio para ver horarios.";
        return;
      }

      const svc = services[serviceSelect.value];
      const start = OPEN*60;
      const end = CLOSE*60;
      const lastStart = end - svc.duration;

      for(let t=start; t<=lastStart; t+=STEP){
        const time = fmtTime(t);
        const b = document.createElement('button');
        b.type = "button";
        b.className = "slot";
        b.textContent = time;

        if(isSlotBooked(selectedDateStr, time)){
          b.disabled = true;
        } else {
          b.addEventListener('click', ()=>{
            document.querySelectorAll('.slot.selected').forEach(x=>x.classList.remove('selected'));
            b.classList.add('selected');
            selectedTimeStr = time;
            slotHint.textContent = `Horario seleccionado: ${time}`;
            okBox.classList.remove('show');
            errorBox.classList.remove('show');
          });
        }
        slotsWrap.appendChild(b);
      }
    }

    serviceSelect.addEventListener('change', ()=>{
      okBox.classList.remove('show');
      errorBox.classList.remove('show');
      buildSlots();
    });

    prevMonthBtn.addEventListener('click', ()=>{
      view = new Date(view.getFullYear(), view.getMonth()-1, 1);
      renderCalendar();
    });
    nextMonthBtn.addEventListener('click', ()=>{
      view = new Date(view.getFullYear(), view.getMonth()+1, 1);
      renderCalendar();
    });

    confirmBtn.addEventListener('click', ()=>{
      okBox.classList.remove('show');
      errorBox.classList.remove('show');

      const name = nameInput.value.trim();
      const email = emailInput.value.trim();
      const phone = phoneInput.value.trim();
      const notes = notesInput.value.trim();
      const serviceKey = serviceSelect.value;

      if(!selectedDateStr){
        errorBox.textContent = "Elige un día en el calendario.";
        errorBox.classList.add('show');
        return;
      }
      if(!serviceKey){
        errorBox.textContent = "Selecciona un servicio.";
        errorBox.classList.add('show');
        return;
      }
      if(!selectedTimeStr){
        errorBox.textContent = "Selecciona un horario.";
        errorBox.classList.add('show');
        return;
      }
      if(!name || !email || !phone){
        errorBox.textContent = "Completa nombre, email y teléfono.";
        errorBox.classList.add('show');
        return;
      }
      if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
        errorBox.textContent = "Email inválido.";
        errorBox.classList.add('show');
        return;
      }
      if(isSlotBooked(selectedDateStr, selectedTimeStr)){
        errorBox.textContent = "Ese horario ya fue reservado. Elige otro.";
        errorBox.classList.add('show');
        buildSlots();
        return;
      }

      const svc = services[serviceKey];
      saveBooking({
        id: (crypto?.randomUUID ? crypto.randomUUID() : String(Date.now())),
        createdAt: new Date().toISOString(),
        date: selectedDateStr,
        time: selectedTimeStr,
        service: svc.name,
        duration: svc.duration,
        price: svc.price,
        name, email, phone, notes
      });

      okBox.classList.add('show');

      nameInput.value = "";
      emailInput.value = "";
      phoneInput.value = "";
      notesInput.value = "";

      renderCalendar();
      buildSlots();
    });

    // Initial render
    renderCalendar();
    buildSlots();
  </script>
</body>
</html>

